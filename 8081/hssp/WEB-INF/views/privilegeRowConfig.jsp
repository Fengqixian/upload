<%@ page language="java" contentType="text/html; charset=UTF-8"    pageEncoding="UTF-8"%><!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Insert title here</title><link rel="stylesheet" type="text/css" href="${pageContext.request.contextPath}/resources/css/basictable.css" />        <link rel="icon" href="${pageContext.request.contextPath}/resources/images/logo ico.png">        <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/Css/bootstrap-3.2.0/bootstrap-theme.min.css" />    <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/Css/bootstrap-3.2.0/bootstrap.min.css" />        <!--  <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/Css/bootstrap-3.3.5-dist/css/bootstrap.css" />    <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/Css/bootstrap-3.3.5-dist/css/bootstrap-theme.css" />-->        <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/Css/css_config.css"  />    <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/Css/jquery-ui-1.11.2.custom/jquery-ui.css" />    <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/Css/coverage.css" />    <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/Css/bootstrap-table-fixed-columns.css">    <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/js/Scriptsbybs/bootstrap-table-develop/dist/bootstrap-table.min.css">      <script src="${pageContext.request.contextPath}/resources/js/Scriptsbybs/jquery-2.1.1.min.js"></script>    <script src="${pageContext.request.contextPath}/resources/css/Css/bootstrap-3.3.5-dist/js/bootstrap.min.js"></script>	<script src="${pageContext.request.contextPath}/resources/js/Scriptsbybs/bootstrap-treeview-dist/bootstrap-treeview.min.js"></script>    <script src="${pageContext.request.contextPath}/resources/js/Scriptsbybs/bootstrap-table-develop/dist/bootstrap-table.min.js"></script>    <script src="${pageContext.request.contextPath}/resources/js/Scriptsbybs/bootstrap-table-develop/dist/locale/bootstrap-table-zh-CN.js"></script>   	<script src="${pageContext.request.contextPath}/resources/js/js/jquery.validate.js"></script>	<script src="${pageContext.request.contextPath}/resources/js/js/jquery.form.js"></script>	 <script src="${pageContext.request.contextPath}/resources/js/Scriptsbybs/jquery-ui-1.11.2.custom/jquery-ui.js"></script>	 <script type="text/javascript" src="${pageContext.request.contextPath}/resources/js/js/jquery.basictable.min.js"></script>	 <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/clinbrain/ztree/zTreeStyle.css" />	<script src="${pageContext.request.contextPath}/resources/clinbrain/ztree/jquery.ztree.all.js"></script>	</head><body>	<div id="priPrivilegeRow_div" style=" height:100%; width:100%; overflow:auto;float:rlght;">			<table  id="privilegeRowTable"></table>	</div>		<!-- 权限行级权限表头按钮 -->	<div id="privilegeRow_div"  style=" height:100%; width:100%; overflow:auto; float:left;">		<div id="toolbarPrivilegeRow" class="btn-group">					<button id="addPrivilegeRow" type="button" class="btn btn-primary"  onclick="showPrivilegeRow()">                <span class="glyphicon glyphicon-plus" aria-hidden="true" ></span>新增            </button>            <button  type="button" class="btn btn-primary" id="hsz" onclick="queryRow('1')">                <span class="glyphicon glyphicon-trash" aria-hidden="true" ></span>回收站            </button>            <button  type="button" class="btn btn-primary" id="yxlb" style="display: none;"  onclick="queryRow('0')">                <span class="glyphicon glyphicon-trash" aria-hidden="true" ></span>返回有效列表            </button>            <span style="float: left; line-height: 34px;">行级名称：</span><input id="search_rowName" class="form-control" style="float: left;width: 140px;"/>            <!--  <span style="float: left; line-height: 34px;">限制值：</span><input id="search_dicFieldValue" class="form-control" style="float: left;width: 140px;"/>            <span style="float: left; line-height: 34px;">说明：</span><input id="search_description" class="form-control" style="float: left;width: 140px;"/>             <span style="float: left; line-height: 34px;">限制类型：</span>            <select id="search_privilegeStatus_dt" class="form-control" style="float: left;width: 100px;">                <option value="">--全部--</option>                <option value="1">固定取值</option>                <option value="">动态取值</option>            </select>             -->            		    <button onclick="searchRow()" class="btn btn-primary">检索</button>        </div>			<table id="priFieldTable"></table>	</div>		<!-- 新增修改行级权限配置页面 -->    <div class="modal fade bs-example-modal-lg" id="showPrivilegeRow" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">        <div class="modal-dialog modal-lg" role="document">            <div class="modal-content" style="height:500px; width:550px;">                <div class="modal-header">                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>                    <h4 class="modal-title" id="showPrivilegeRow_Label">添加</h4>                </div>                <div class="modal-body">                	<div class="form-group col-sm-12">                	 <label class="control-label col-sm-3">行权限名称：</label>                	 <input class="control-label col-sm-8" type="text" id="rowName"/>                	 </div>	                <div class="form-group col-sm-12">	                    <label class="control-label col-sm-3">表</label>                        <select class="control-label col-sm-8" name="privilegeRowTables" id="privilegeRowTables" onchange="getTableColumn(this.value,'0')"                                class="form-control input-background">                            <option value="">--请选择--</option>                        </select>	                </div>	                <div class="form-group col-sm-12">	                    <label class="control-label col-sm-3">字段</label>                        <select class="control-label col-sm-8" name="privilegeRowTableColumns" id="privilegeRowTableColumns"                                class="form-control input-background">                            <option value="">--请选择--</option>                        </select>	                </div>	                <div class="form-group col-sm-12">	                	<label class="control-label col-sm-3">限制类型：</label>						<label class="control-label col-sm-3"> <input  type="radio" name="privilegeStatus"  value="1" onchange="checkFixed()">固定取值</label>	                	<label class="control-label col-sm-3"> <input  type="radio" name="privilegeStatus"  value="2" onchange="checkFixed()">动态取值</label>					</div>	                <div class="form-group col-sm-12" id="dicFieldValue_dt_div" style="display:none" >	                	<label class="control-label col-sm-3">动态限制值：</label>	                	<select class="control-label col-sm-8" id="dicFieldValue_dt" onchange="onDicFieldValue(this.value)" class="form-control input-background">                            <option value="">--请选择--</option>                        </select>                    </div>	                <div class="form-group col-sm-12" id="dicFieldValue_gd_div" >	                	<label class="control-label col-sm-3">固定限制值：</label>	                	<input class="control-label col-sm-8" type="text" id="dicFieldValue_gd" />	                </div>					<div class="form-group col-sm-12" >					<label class="control-label col-sm-3">备&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;注：</label>					<input class="control-label col-sm-8" type="text" name="description" id="description"/></div>	                <div class="modal-footer" style="margin-top: 20px;">	                    <button type="button" class="btn btn-primary" data-dismiss="modal"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span>关闭</button>	                    <button type="button" id="btn_submit" class="btn btn-primary" data-dismiss="modal" onclick="savePrivilegeRow()"><span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>保存</button>	                </div>	            </div>	        </div>	    </div>    </div>    <div id="hiddenInfo" style="display: none">		<input type="text" name="hid_privilegeRowId" id="hid_privilegeRowId" />		<input type="text" name="hid_dicFieldId" id="hid_dicFieldId" />		<input type="text" name="hid_dicFieldValue" id="hid_dicFieldValue" />		<input type="text" name="hid_tableId" id="hid_tableId" />		<input type="text" name="hid_isDeleted" id="hid_isDeleted" />	</div>	</body><script type="text/javascript">   	  //页面初始化   	   $(function(){                  //调用函数，初始化表格          queryRow("0");          //当点击查询按钮的时候执行          document.getElementById('rolePrivilegeRow').style.display='none';    	  document.getElementById('priPrivilegeRow_div').style.display='block';         // $("#search").bind("click", queryRow);      });            function checkFixed(){    	var valueCheck = $('input:radio[name="privilegeStatus"]:checked').val();    	$("#dicFieldValue_gd").val("");    	if(valueCheck == 1){    		 $("#dicFieldValue_gd").removeAttr("disabled"); 			$("#dicFieldValue_dt_div").hide(1000);            //$("#dicFieldValue_gd_div").show(1000);        }else if(valueCheck == 2){        	$("#dicFieldValue_gd").attr("disabled", "disabled" )        	//$("#dicFieldValue_gd_div").hide();            $("#dicFieldValue_dt_div").show(1000);        }      }      function queryRow(isDeleted){		$("#search_rowName").val("");		$("#search_dicFieldValue").val("");		$("#search_description").val("");		$("#search_privilegeStatus_dt").val("");		getPrivilegeRow(isDeleted,"","","","");	  }      //查询      function getPrivilegeRow(isDeleted,rowName,dicFieldValue,description,privilegeStatus) {      	  $("#hid_isDeleted").val(isDeleted);	      if(isDeleted==0){	     	 $("#addPrivilegeRow").show();	     	 $("#hsz").show();	     	 $("#yxlb").hide(); 	      }else{	   		 $("#yxlb").show();	   		 $("#addPrivilegeRow").hide();	   		 $("#hsz").hide();	   	  }        //先销毁表格        $("#privilegeRowTable").bootstrapTable('destroy');        //初始化表格,动态从服务器加载数据        $("#privilegeRowTable").bootstrapTable({            url: "/hssp/configTableController/getPrivilegeRow", //获取数据的Servlet地址	        method: "POST",  //使用get请求到服务器获取数据	        contentType: "application/x-www-form-urlencoded",//post请求的话就加上这个句话         	toolbar: '#toolbarPrivilegeRow',                //工具按钮用哪个容器            striped: true,                      //是否显示行间隔色            cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）            pagination: true,                   //是否显示分页（*）            sortable: false,                     //是否启用排序            sortOrder: "asc",                   //排序方式            sidePagination: "client",           //分页方式：client客户端分页，server服务端分页（*）            pageNumber:1,                       //初始化加载第一页，默认第一页            pageSize: 10,                       //每页的记录行数（*）            pageList: [5, 10],        			//可供选择的每页的行数（*）            search: false,                       //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大            strictSearch: true,            showColumns: false,                  //是否显示所有的列            showRefresh: false,                  //是否显示刷新按钮            minimumCountColumns: 2,             //最少允许的列数            clickToSelect: true,                //是否启用点击选中行            height: "",                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度            uniqueId: "ID",                     //每一行的唯一标识，一般为主键列            showToggle:false,                    //是否显示详细视图和列表视图的切换按钮            cardView: false,                    //是否显示详细视图            detailView: false,                   //是否显示父子表            queryParams: function queryParams(params) {   //设置查询参数              var param = {                    pageNumber: params.pageNumber,                    pageSize: params.pageSize,                  isDeleted : isDeleted,                  rowName : rowName,                  dicFieldValue : dicFieldValue,                  description : description,                  privilegeStatus : privilegeStatus              };                return param;                             },            formatLoadingMessage: function () {                return "请稍等，正在加载中...";            },            formatNoMatches: function () {  //没有匹配的结果                return '无符合条件的记录';            },                        columns: [                    {               	         title: "序号",               	         field: "rowNum",               	         valign:'middle',               	         align:'center',               	         formatter:function(value,row,index){          	 	              return index+1;           	 	       }                     },{                        title: '行级名称',                        field: 'Row_Name',                        align: 'center',                        valign: 'middle',                    },{                        title: '表名称',                        field: 'tableName',                        align: 'center',                        valign: 'middle',                    },{                        title: '列权限名称',                        field: 'DisplayName',                        align: 'center',                        valign: 'middle',                    },{                        title: '限制值',                        field: 'Dic_Field_Value',                        align: 'center',                        valign: 'middle',                    },{                      title: '说明',                        field: 'Description',                        align: 'center',                        valign: 'middle'                    },{                      title: '限制类型',                        field: 'Privilege_Status',                        align: 'center',                        formatter:function(value,row,index){                        	if (value == '1') {			                    return "固定值";			                } else if (value == '2') {			                    return "动态值";			                } else if (value == '3') {			                    return "行级别权限无限制";			                } else{			                    return value;			                }                          }                     },{                        title: '操作',                        field: 'Id',                        align: 'center',                        formatter:function(value,row,index){	                        	if(isDeleted==0){		                        	if(row.Privilege_Status != '3'){						            	var a = "<a href=\"#\" mce_href=\"#\" onclick=\"editPrivilegeRow('"+ row.Id +"','"+ row.Row_Name +"','"+ row.tableId +"','"+ row.Dic_Field_Id +"','"+ row.Dic_Field_Value +"','"+ row.Description +"','"+ row.Privilege_Status +"')\">修改</a>  ";		                                a = a + "<a href=\"#\" mce_href=\"#\" onclick=\"restorePrivilegeRow('"+ row.Id +"','"+1+"')\">删除</a>  ";  		                            	return a;  		                        	}else{			                        	return "";		                        	}				              	}else{				               		var d = "<a href=\"#\" mce_href=\"#\" onclick=\"restorePrivilegeRow('"+ row.Id+"',"+0+")\">恢复</a> ";				                	return d;				               	}                      }                     }                ],                responseHandler: function(data){                    return data.rows;            }          });      }     //新增角色权限行级权限展示框    function showPrivilegeRow(){    	clearModal();		getTableColumn_table("0");		getTableFieldDescriptionSelect();		$("#showPrivilegeRow_Label").text("新增行级权限");		$("#showPrivilegeRow").modal();		checkFixed();    }    function onDicFieldValue(values){        var dicFieldValue = $("#dicFieldValue_gd").val();    	$("#dicFieldValue_gd").val(dicFieldValue + values);    }    //清空新增修改modal框    function clearModal(){    	$("#rowName").val("");		$("#privilegeRowTables").val("");		$("#privilegeRowTableColumns").val("");		$("#dicFieldValue_dt").val("");		$("#dicFieldValue_gd").val("");		$("#description").val("");				$("#hid_privilegeRowId").val("");    	$("#hid_dicFieldId").val("");    	$("#hid_tableId").val("");		$("#hid_dicFieldValue").val("");		$("input[name='privilegeStatus']").each(function(){			if($(this).val() == "1"){				$(this).prop( "checked", true );			}		});    }    //动态值下拉框    function getTableFieldDescriptionSelect(){	    var datas = {};    	$.ajax(		{			type : "post",			url : "/hssp/configTableController/getTableFieldDescriptionSelect",			data : datas,			dataType : "json",			success : function(result) 			{				var tableColumnsArray = eval(result.searchSet);				var tableColumnsObj =document.getElementById("dicFieldValue_dt");                tableColumnsObj.options.length = 1;                for(var i=0;i<tableColumnsArray.length;i++)                {                     var tableColumn = tableColumnsArray[i];                     var id = "$"+tableColumn.FieldName+"$";                     var name = tableColumn.Description;                     tableColumnsObj.options[tableColumnsObj.options.length] =  new Option(name,id);                }			}		});    }    //二级联动第一层(表名称下拉列表展示)    function getTableColumn_table(tpeys){	    var datas = {};    	$.ajax(		{			type : "post",			url : "/hssp/configTableController/getTable",			data : datas,			dataType : "json",			success : function(result) 			{				var tableArray = eval(result.searchSet);				var tableObj = document.getElementById("privilegeRowTables");                tableObj.options.length = 1;                for(var i=0;i<tableArray.length;i++)                {                     var tableColumn = tableArray[i];                     var id = tableColumn.Id;                     var name = tableColumn.Description;                     tableObj.options[tableObj.options.length] =  new Option(name,id);                }                if(tpeys=="1"){                	var tableId =$("#hid_tableId").val();                	$("#privilegeRowTables").val(tableId);                }			}		});    }    //二级联动(列字段下拉列表展示)    function getTableColumn(tableId,tpeys){	    var datas = {tablesId:tableId};    	$.ajax(		{			type : "post",			url : "/hssp/configTableController/getTableColumn",			data : datas,			dataType : "json",			success : function(result) 			{				var tableColumnsArray = eval(result.searchSet);				var tableColumnsObj = document.getElementById("privilegeRowTableColumns");                tableColumnsObj.options.length = 1;                for(var i=0;i<tableColumnsArray.length;i++)                {                     var tableColumn = tableColumnsArray[i];                     var id = tableColumn.Id;                     var name = tableColumn.DisplayName;                     tableColumnsObj.options[tableColumnsObj.options.length] =  new Option(name,id);                }                if(tpeys=="1"){                	var dicFieldId =$("#hid_dicFieldId").val();                	$("#privilegeRowTableColumns").val(dicFieldId);                }			}		});    }    //行级权限保存	function savePrivilegeRow(){		var id =$("#hid_privilegeRowId").val();	    var rowName = $("#rowName").val();	    var reg = new RegExp(" ","g");	    rowName = rowName.replace(reg,"");		if(rowName == ""){			alert("行权限名称不能为空!");			return;		}		var dicFieldId = $("#privilegeRowTableColumns option:selected").val();		var dicFieldValue= "";		var privilegeStatus = $("input[name='privilegeStatus']:checked").val();		var description= $("#description").val();		if(privilegeStatus == "1"){			dicFieldValue = $("#dicFieldValue_gd").val();		}else if(privilegeStatus == "2"){			dicFieldValue = $("#dicFieldValue_dt option:selected").val();		}		if(rowName ==""){			alert("行级权限名称不能为空");			return;		}		if(dicFieldId ==""){			alert("请选择限制的行条件");			return;		}		if(dicFieldValue ==""){			alert("请填写限制的行条件值");			return;		}		var datas = {				id :id,				rowName : rowName,				dicFieldId : dicFieldId,				dicFieldValue : dicFieldValue,				privilegeStatus : privilegeStatus,				description : description    	};		 $.ajax({ 	        type:"POST", 	        url:"/hssp/configTableController/savePrivilegeRow", 	        dataType: "json", 	        data:datas, 	        cache: false,	        async : false, 	        success:function(result){ 	        	if (result.status == "addSucceed"){ 	        		alert("新增成功!"); 	        	}else if(result.status == "updateSucceed"){ 	        		alert("修改成功!"); 	        	}else{ 	        		alert("操作失败!"); 	        	}			} 	    });		queryRow("0");		clearModal();    }	 //角色行权限修改     function editPrivilegeRow(id,rowName,tableId,dicFieldId,dicFieldValue,description,privilegeStatus){    	$("#hid_privilegeRowId").val(id);    	$("#hid_dicFieldId").val(dicFieldId);    	$("#hid_tableId").val(tableId);		$("#rowName").val(rowName);		$("#description").val(description);		getTableFieldDescriptionSelect();		$("#hid_dicFieldValue").val(dicFieldValue);	    $("#dicFieldValue_gd").val(dicFieldValue);	    $("#dicFieldValue_gd").val(dicFieldValue);	    if(privilegeStatus == 1){	    	$("#dicFieldValue_gd").removeAttr("disabled"); 	    	$("#dicFieldValue_dt_div").hide(1000);	    }else if(privilegeStatus == 2){	    	$("#dicFieldValue_dt_div").show(1000);	    	$("#dicFieldValue_gd").attr("disabled", "disabled" )	    }		//限制类型动态控制限制方式		//showDicFieldValue(privilegeStatus);		//表名称下拉框		getTableColumn_table("1");		//字段名称下拉框		getTableColumn(tableId,"1");		$("#showPrivilegeRow_Label").text("修改行级权限");		$("#showPrivilegeRow").modal();     }    //删除恢复行级权限    function restorePrivilegeRow(id,isDeleted){	    	var datas = {		    	id : id,		    	isDeleted : isDeleted	    	};			 $.ajax({	 	        type:"POST",	 	        url:"/hssp/configTableController/deletePrivilegeRow",	 	        dataType: "json",	 	        data:datas,	 	        cache: false,		        async : false,	 	        success:function(result){	 	        	if (result.status == "succeed" && isDeleted=="0"){	 	        		alert("该用户恢复成功，请在有效列表查看!");	 	        	}	 	        	if (result.status == "succeed" && isDeleted=="1"){	 	        		alert("该用户删除成功，可以在回收站恢复!");	 	        	}				}	 	    });	 	    if(isDeleted=="0"){				queryRow(1);	 	    }else{				queryRow(0);	 	    }    }    function searchRow(){    	var isDeleted=$("#hid_isDeleted").val();    	var rowName=$("#search_rowName").val();		var dicFieldValue=$("#search_dicFieldValue").val();		var description=$("#search_description").val();		var privilegeStatus=$("#search_privilegeStatus_dt").val();    	getPrivilegeRow(isDeleted,rowName,dicFieldValue,description,privilegeStatus);    }</script></html>