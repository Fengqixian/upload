<%@ page language="java" contentType="text/html; charset=UTF-8"    pageEncoding="UTF-8"%><!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>科研检索后台</title><link rel="stylesheet" type="text/css" href="${pageContext.request.contextPath}/resources/css/basictable.css" />        <link rel="icon" href="${pageContext.request.contextPath}/resources/images/logo ico.png">        <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/Css/bootstrap-3.2.0/bootstrap-theme.min.css" />    <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/Css/bootstrap-3.2.0/bootstrap.min.css" />        <!--  <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/Css/bootstrap-3.3.5-dist/css/bootstrap.css" />    <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/Css/bootstrap-3.3.5-dist/css/bootstrap-theme.css" />-->        <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/Css/css_config.css"  />    <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/Css/Approval_Process.css"/>    <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/Css/jquery-ui-1.11.2.custom/jquery-ui.css" />    <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/Css/coverage.css" />    <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/Css/bootstrap-table-fixed-columns.css">    <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/js/Scriptsbybs/bootstrap-table-develop/dist/bootstrap-table.min.css">      <script src="${pageContext.request.contextPath}/resources/js/Scriptsbybs/jquery-2.1.1.min.js"></script>    <script src="${pageContext.request.contextPath}/resources/css/Css/bootstrap-3.3.5-dist/js/bootstrap.min.js"></script>	<script src="${pageContext.request.contextPath}/resources/js/Scriptsbybs/bootstrap-treeview-dist/bootstrap-treeview.min.js"></script>    <script src="${pageContext.request.contextPath}/resources/js/Scriptsbybs/bootstrap-table-develop/dist/bootstrap-table.min.js"></script>    <script src="${pageContext.request.contextPath}/resources/js/Scriptsbybs/bootstrap-table-develop/dist/locale/bootstrap-table-zh-CN.js"></script>   	<script src="${pageContext.request.contextPath}/resources/js/js/jquery.validate.js"></script>	<script src="${pageContext.request.contextPath}/resources/js/js/jquery.form.js"></script>	 <script src="${pageContext.request.contextPath}/resources/js/Scriptsbybs/jquery-ui-1.11.2.custom/jquery-ui.js"></script>	 <script type="text/javascript" src="${pageContext.request.contextPath}/resources/js/js/jquery.basictable.min.js"></script>	 <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/clinbrain/ztree/zTreeStyle.css" />	<script src="${pageContext.request.contextPath}/resources/clinbrain/ztree/jquery.ztree.all.js"></script>	<style type="text/css">		.ui-dialog .ui-dialog-titlebar-close {display:none}	</style></head><body><!-- 角色展示 --><div id="priRole_div"  style="height:100%; width:100%; overflow:auto; float:left;display:none;">		<div id="toolbarPriFieldRole" class="btn-group">			<button  type="button" class="btn btn-primary" id="addRole" onclick="addPrivilegeRole()">                <span class="glyphicon glyphicon-plus" aria-hidden="true" ></span>新增            </button>            <button  type="button" class="btn btn-primary" id="hsz" onclick="queryRole('1')">                <span class="glyphicon glyphicon-trash" aria-hidden="true" ></span>回收站            </button>            <button  type="button" class="btn btn-primary" id="yxlb" style="display: none;"  onclick="queryRole('0')">                <span class="glyphicon glyphicon-trash" aria-hidden="true" ></span>返回有效列表            </button>            <span style="float: left; line-height: 34px;">角色名称：</span>			<input id="search_roleName" class="form-control" style="float: left;width: 140px;"/> 			<span style="float: left; line-height: 34px; display:none;">角色描述：</span>			<input id="search_roleDescription" class="form-control" style="float: left;width: 140px;display:none;"/>  		    <button onclick="roleSearch()" class="btn btn-primary">检索</button>        </div>		<table id="priRoleTable"></table></div><!-- 权限行级权限表头按钮 --><div id="rolePrivilegeRow"  style=" height:100%; width:100%; overflow:auto; float:left;display:none;" >		<div id="toolbarRolePrivilegeRow" class="btn-group">		<button  type="button" class="btn btn-primary">                <span aria-hidden="true">角色下行级权限</span>            </button>			<button  type="button" class="btn btn-primary">                <span>当前角色：</span><span aria-hidden="true" id="Row_role_name"></span>            </button>			<button  type="button" class="btn btn-primary"  onclick="showAddRolePrivilegeRow()">                <span class="glyphicon glyphicon-plus" aria-hidden="true" ></span>新增            </button>            <button  type="button" class="btn btn-primary" onclick="showPriRole('rolePrivilegeRow','priRole_div')">                <span class="glyphicon glyphicon-remove" aria-hidden="true" ></span>返回上一级            </button>            <span style="float: left">行级权限姓名：</span>			<input id="rowName" class="form-control" style="width:140px; display: inline-block; float: left"/>  		    <button style="display: inline-block" onclick="showRolePrivilegeRow()" class="btn btn-primary">检索</button>        </div>			<table id="priPrivilegeRowTable"></table></div><div id="priUser_div"  style=" height:100%; width:100%; overflow:auto; float:left;display:none;">	<div id="toolbarPriField_show" class="btn-group">			<button  type="button" class="btn btn-primary">                <span aria-hidden="true">查看用户</span>            </button>			<button id="" type="button" class="btn btn-primary">                <span>当前角色：</span><span aria-hidden="true"id="role_name"></span>            </button>            			            <div id="priUser_div_Adduser" class="btn-group" style="display:none">                <button id="addPriUser" type="button" class="btn btn-primary"  onclick="addRole_user_Select(4)">                	<span class="glyphicon glyphicon-plus" aria-hidden="true" ></span>新增           		</button>	            <button  type="button" class="btn btn-primary" onclick="showPriRole('priUser_div','priRole_div')">	                <span class="glyphicon glyphicon-share-alt" aria-hidden="true" ></span>返回上一级	            </button>	            <span style="float: left; line-height: 34px;">用户id：</span><input id="searchUserId" class="form-control" style="float: left;width: 140px;"/>  	            <span style="float: left; line-height: 34px;">用户名称：</span><input id="searchUserName" class="form-control" style="float: left;width: 140px;"/>   			    <button onclick="searchUser(3,'searchUserId','searchUserName')" class="btn btn-primary">检索</button>		    </div>             <div id="priUser_div_Adduser" class="btn-group" style="display:none">                <button id="addPriUser" type="button" class="btn btn-primary"  onclick="addRole_user_Select(7)">                	<span class="glyphicon glyphicon-plus" aria-hidden="true" ></span>新增           		</button>	            <button  type="button" class="btn btn-primary" onclick="showPriRole('priUser_div','priRole_div')">	                <span class="glyphicon glyphicon-share-alt" aria-hidden="true" ></span>返回上一级	            </button>	            <span style="float: left; line-height: 34px;">用户id：</span><input id="searchUserId" class="form-control" style="float: left;width: 140px;"/>  	            <span style="float: left; line-height: 34px;">用户名称：</span><input id="searchUserName" class="form-control" style="float: left;width: 140px;"/>   			    <button onclick="searchUser()" class="btn btn-primary">检索</button>		    </div>		        </div>			<table  id="priUserTable"></table></div><div id="priUser_div_Add"  style=" height:100%; width:100%; overflow:auto; float:left;display:none;">	<div id="toolbarPriField_add" class="btn-group">			<button  type="button" class="btn btn-primary">                <span aria-hidden="true">添加用户</span>            </button>			<button  type="button" class="btn btn-primary">                <span>当前角色：</span><span aria-hidden="true"id="Add_role_name"></span>            </button>            <button id="showPriUser" type="button" class="btn btn-primary" onclick="return_ShowRole_user()">                <span class="glyphicon glyphicon-share-alt" aria-hidden="true" ></span>返回上一级            </button>		    <span style="float: left; line-height: 34px;">用户id：</span><input id="search_userId" class="form-control" style="float: left;width: 140px;"/> 			<span style="float: left; line-height: 34px;">用户名称：</span><input id="search_userName" class="form-control" style="float: left;width: 140px;"/>   		    <button onclick="addRole_user_search()" class="btn btn-primary">检索</button>    </div>			<table  id="priUserTable_Add"></table></div><div id="rolePrivilegeRow_Add"  style=" height:100%; width:100%; overflow:auto; float:left;display:none;" >		<div id="toolbarPriRolePrivilegeRow_Add" class="btn-group">		<button  type="button" class="btn btn-primary">                <span aria-hidden="true">角色下追加行级权限</span>            </button>			<button  type="button" class="btn btn-primary">                <span>当前角色：</span><span aria-hidden="true"id="Add_Row_role_name"></span>            </button>            <button  type="button" class="btn btn-primary" onclick="showRolePrivilegeRow()">                <span class="glyphicon glyphicon-remove" aria-hidden="true" ></span>返回上一级            </button>            <span style="float: left; line-height: 34px;">行级权限姓名：</span><input id="addRoW_rowName"  class="form-control" style="float: left;width: 140px;"/> 		    <button onclick="showAddRolePrivilegeRow()" class="btn btn-primary">检索</button>        </div>			<table id="priPrivilegeRowTable_Add"></table></div><!-- 列权限分配(列权限树) -->     <div class="modal fade bs-example-modal-lg" id="showPrivilegeColumnItem" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">        <div class="modal-dialog modal-lg" role="document">            <div class="modal-content" style="height:500px; width:350px;">                <div class="modal-header">                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>                    <h4 class="modal-title" id="showPrivilegeColumnItem_Label">权限分配</h4>                </div>                <div class="modal-body">                    <div class="form-group" >	                 	<div class="btn-group" role="group">	                         <!-- <button type="button" onclick="getSolrDBFieldInfo()" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">	                                                                                           展示字段1</button> -->	                         <!-- Time screening -->							<div class="c-tip-con dropdown-button" id="return_search" >											<div id="div_solrTableAndField" title="检索返回字段勾选"									style="text-align:left;">									<ul id="solrTableAndFieldTree" class="ztree" style="overflow:auto;"></ul>								</div>								<div class="c-tip-menu c-tip-timerfilter">									<ul style="line-height:30px">										<li class=".c-tip-custom"  style="padding: 0 0px 0px 9px;position: relative;zoom: 1;">										<a class="c-tip-custom-submit"											onclick="return_search_submit()">确认</a> <a											class="c-tip-custom-submit" onclick="return_search_cancel()">取消</a>										</li>										<li></li>									</ul>								</div>								<!-- <div class="modal-footer">				                    <button type="button" class="btn btn-primary" data-dismiss="modal"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span>关闭</button>				                    <button type="button" id="btn_submit" class="btn btn-primary" data-dismiss="modal" onclick="saveAddPriFieldValue()"><span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>保存</button>				                </div> -->							</div>						</div>                 </div>            </div>        </div>    </div>    </div>		<!-- 新增角色配置页面 -->    <div class="modal fade bs-example-modal-lg" id="insertRole" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">        <div class="modal-dialog modal-lg" role="document">            <div class="modal-content" style="height:400px; width:250px;">                <div class="modal-header">                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>                    <h4 class="modal-title" id="insertRole_Label">添加角色</h4>                </div>                <div class="modal-body">                    <div>角色名称：<input type="text" name="insertRoleName" id="insertRoleName"/></div>                    <div>角色描述：<input type="text" name="insertDescription" id="insertDescription"/></div>	                <div class="modal-footer" style="margin-top: 100px;">	                    <button type="button" class="btn btn-primary" data-dismiss="modal"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span>关闭</button>	                    <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="saveRole()"><span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>保存</button>	                </div>	            </div>	        </div>	    </div>    </div>    <!-- 修改角色配置页面 -->    <div class="modal fade bs-example-modal-lg" id="updateRole" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">        <div class="modal-dialog modal-lg" role="document">            <div class="modal-content" style="height:400px; width:250px;">                <div class="modal-header">                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>                    <h4 class="modal-title" id="insertRole_Label">修改角色</h4>                </div>                <div class="modal-body">                    <div>角色名称：<input type="text" name="updateRoleName" id="updateRoleName" disabled="disabled"/></div>                    <div>角色描述：<input type="text" name="updateDescription" id="updateDescription"/></div>	                <div class="modal-footer" style="margin-top: 100px;">	                    <button type="button" class="btn btn-primary" data-dismiss="modal"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span>关闭</button>	                    <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="updatePrivilegeRole()"><span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>保存</button>	                </div>	            </div>	        </div>	    </div>    </div><div id="Approval_Process_Right" class="right" style="display: none;">   <div class="right-list">	   <div class="titel" id = "Approval_Process_Right_DIV_Title" style="font-size: 20px;height: 3%">追加审批流程</div>       <div class="modal-body" style="height: 10%">         <div class="form-group col-sm-12"><label class="control-label col-sm-3">流程名称：</label><div class="col-sm-8"><input id="Approval_Process_Right_Title" maxlength="8"  class="form-control" style="float: left;width: 100%;"/></div> </div>         <div class="form-group col-sm-12"><label class="control-label col-sm-3">流程描述：</label><div class="col-sm-8"><textarea id="Approval_Process_Right_Description" maxlength="40"  rows='1' cols='30' class="form-control"   style="resize:none;float: left;width: 100%;"></textarea></div> </div>	 	 <input id="Approval_Process_Right_hidden_Role_id" style="display:none"/>       	 <input id="Approval_Process_Right_hidden_Role_name" style="display:none"/>       	 <input id="Approval_Process_Right_hidden_ApprovalProcessGroupID" style="display:none"/>         <input id="Approval_Process_Right_hidden_id" style="display:none"/>       	 <input id="Approval_Process_Right_hidden_className" style="display:none"/>       </div>       <div class="modal-footer" id="Approval_Process_Right_Add" style="margin-top: 100px;height: 3% ;display:none">               <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="processAdd()"><span class="glyphicon glyphicon-plus" aria-hidden="true"></span>追加</button>               <button type="button" class="btn btn-primary" data-dismiss="modal" onClick="processClose('hidden'),setTimeout('reduceWidth(50,2)', 10)"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span>关闭</button>       </div>       <div class="modal-footer" id="Approval_Process_Right_Show" style="margin-top: 100px;height: 3% ;display:none">               <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="processUpdate(2)"><span class="glyphicon glyphicon-arrow-up" aria-hidden="true"></span>上移</button>               <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="processUpdate(3)"><span class="glyphicon glyphicon-arrow-down" aria-hidden="true"></span>下移</button>               <button type="button" class="btn btn-primary" data-dismiss="modal" onclick="processUpdate(1)"><span class="glyphicon glyphicon-floppy-save" aria-hidden="true"></span>更新</button>               <button type="button" class="btn btn-primary" data-dismiss="modal" onClick="processUpdate(4)"><span class="glyphicon glyphicon-trash" aria-hidden="true"></span>删除</button>               <button type="button" class="btn btn-primary" data-dismiss="modal" onClick="processClose('hidden'),setTimeout('reduceWidth(50,2)', 10)"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span>关闭</button>       </div>       <div id="Approval_Process_div_Add"  style=" height:75%; width:100%; overflow:auto; float:left;display:none;">			<div id="Approval_Process_toolbar_add" class="btn-group">					<button  type="button" class="btn btn-primary" onclick="refreshApprovalProcessUser()">		                <span class="glyphicon glyphicon-refresh" aria-hidden="true"></span><span aria-hidden="true">刷新</span>		            </button>		            <button  type="button" class="btn btn-primary" onclick="reloadApprovalProcessUser('')">		                <span class="glyphicon glyphicon-plus" aria-hidden="true"></span><span aria-hidden="true">查看用户</span>		            </button>					<button  type="button" class="btn btn-primary" onclick="addApprovalProcessUser('')">		                <span class="glyphicon glyphicon-plus" aria-hidden="true"></span><span aria-hidden="true">添加用户</span>		            </button>		            <input id="searchNameForApproval"  class="form-control" style="float: left;width: 140px;"/> 		    		<button onclick="searchUserForApproval()" class="btn btn-primary">检索</button>		           <!--  <button  type="button" class="btn btn-primary" onclick="reloadApprovalProcessUser()">		                <span class="glyphicon glyphicon-trash" aria-hidden="true"></span><span aria-hidden="true">删除用户</span>		            </button> -->		    </div>			<table  id="Approval_Process_Table_Add"></table>       </div>	</div></div><div id="Approval_Process_Show"  style=" width:100%; overflow:auto; float:left;display:none;" >	<ul class="list" id="Approval_Process_ul_id" style="height:100vh;">					</ul></div><div id="hiddenInfo" style="display: none">	<form id="getForm">		<input type="text" name="hid_priUserId" id="hid_priUserId" />		<input type="text" name="hid_fieldId" id="hid_fieldId" />		<input type="text" name="hid_valueId" id="hid_valueId" />		<input type="text" name="hid_dicDataBaseId" id="hid_dicDataBaseId" />		<input type="text" name="hid_role_id" id="role_id" />		<input type="text" name="hid_roleName" id="hid_roleName" />		<input type="text" name="hid_isDeleted" id="hid_isDeleted" />	</form></div></body><script type="text/javascript">//默认为审批流程检索用户为1：查看用户，  2：添加用户，var searchUserForApprovalType = 1;$(document).ready(function () {            //调用函数，初始化表格    queryRole("0");    //当点击查询按钮的时候执行	  $("#priRole_div").show();        //$("#search").bind("click", initTable);});/** * 检索 用户 */function  searchUserForApproval() {	var searchName = $("#searchNameForApproval").val();	if(searchUserForApprovalType == 1){		reloadApprovalProcessUser(searchName);	}else if(searchUserForApprovalType == 2){		addApprovalProcessUser(searchName);	}}function  getUser_role(role_id,method,role_name) {	  $("#searchUserId").val("");	  $("#searchUserName").val("");	  $("#priRole_div").hide();	  $("#priUser_div_Adduser").show();	  $("#role_name").text(role_name);	  $("#Add_role_name").text(role_name);	  $("#role_id").val(role_id);	  initTable_user(role_id,method,"priUserTable","","","toolbarPriField_show");	  $("#priUser_div").show();}/** * 选择用户 */function  addRole_user_Select(method) {		$("#search_userId").val("");	$("#search_userName").val("");	$("#priUser_div").hide();	initTable_user($("#role_id").val(),method,"priUserTable_Add","","","toolbarPriField_add");	$("#priUser_div_Add").show();	 }/***************权限审批流程用户追加***********************/function processClose(id,className){	if(id == "hidden"){	 id =  $("#Approval_Process_Right_hidden_id").val();	 className =  $("#Approval_Process_Right_hidden_className").val();	}	$("#Approval_Process_div_Add").hide(1000);	$("#Approval_Process_Right").hide(100);	//$("#Approval_Process_Show").css("width","100%");	//setTimeout("reduceWidth(50,2)", 10);	$("#Approval_Process_Right_Description").text("");	$("#Approval_Process_Right_Title").val("");	 nextAdd = false;	 removeClassCheck(id,className);}/** * 更新审批流程参数 */function  processUpdate(method) {	if (method == 1){			}else if (method == 2){		if(!confirm("确定上移？")){			return;		}	}else if (method == 3){		if(!confirm("确定下移？")){			return;		}	}else if (method == 4){		if(!confirm("确定删除当前流程？")){			return;		}	}	var Process_Title = $("#Approval_Process_Right_Title").val();    var Process_Description = $("#Approval_Process_Right_Description").val();	var role_id = $("#Approval_Process_Right_hidden_Role_id").val();	var approvalProcessGroupID = $("#Approval_Process_Right_hidden_ApprovalProcessGroupID").val();	 var role_name = $("#Approval_Process_Right_hidden_Role_name").val();	var Approval_Order = $("#Approval_Process_Right_hidden_id").val().split("Approval_Process_div_Add_")[1];	$.ajax({	   	  type:"POST",	      url:"/hssp/configTableController/processUpdate",	      dataType: "json",	      data:"role_id="+role_id+"&method="+method+"&Approval_Order="+Approval_Order    		 +"&title="+Process_Title+"&description="+Process_Description+"&approvalProcessGroupID="+approvalProcessGroupID,	      cache: false,	     async : false,   	     success: function(data){   	    	 	 if(data.result == "succeed"){  	    	 		alert("操作成功!");  	    	 		//editApproval_Process(role_id,1,role_name,"Approval_Process_div_Add_"+data.Approval_Order,data.id,Process_Title,Process_Description);  	    	 		if(method == 2 ||　method == 3){	   	    	 		//processClose('hidden',1);	   	    	 		//setTimeout("reduceWidth(50,2)", 10);	   	    	 		editApproval_Process(role_id,1,role_name,"none","","","");   	    	 			setTimeout("showApprovalProcessUser('Approval_Process_div_Add_"+data.Approval_Order+"',"+data.id+",'"+Process_Title+"','"+Process_Description+"');",1000);   	    	 		}else if(method == 1){   	    	 			//alert("Approval_Process_div_Add_Title_"+data.Approval_Order);   	    	 			//alert("Approval_Process_Add_Description_"+data.Approval_Order);	   	    	 		$("#Approval_Process_div_Add_Title_"+data.Approval_Order).html(Process_Title);	   	    	 		$("#Approval_Process_Add_Description_"+data.Approval_Order).html(Process_Description);   	    	 		}else if(method == 4){   	    	 			//processClose('hidden',1);	   	    	 		//setTimeout("reduceWidth(50,2)", 10);	   	    	 		editApproval_Process(role_id,1,role_name,"none","","","");   	    	 		}   	    		 }else{   	    			 alert("更新失败！");   	    		 }   	    	 },error:function(e){	   	    		parent.location.reload();    	    				}	 });  }/** * 追加新的审批流程 */function  processAdd() {	var Process_Title = $("#Approval_Process_Right_Title").val();	var reg = new RegExp(" ","g");	Process_Title = Process_Title.replace(reg,"");	if(Process_Title == ""){		alert("流程名称不能为空!");		return;	}    var Process_Description = $("#Approval_Process_Right_Description").val();	var method = 1;	var role_id = $("#Approval_Process_Right_hidden_Role_id").val();	 var role_name = $("#Approval_Process_Right_hidden_Role_name").val();	var Approval_Order = $("#Approval_Process_Right_hidden_id").val().split("Approval_Process_Span_Add_")[1];	$.ajax({   	  type:"POST",       url:"/hssp/configTableController/processAdd",       dataType: "json",       data:"role_id="+role_id+"&method="+method+"&Approval_Order="+Approval_Order	    		 +"&title="+Process_Title+"&description="+Process_Description,       cache: false,      async : false,   	     success: function(data){   	    	 	 if(data.result == "succeed"){   	    	 		processClose('hidden',1);   	    	 		setTimeout("reduceWidth(50,2)", 10);   	    	 		//editApproval_Process(role_id,1,role_name,"Approval_Process_div_Add_"+data.Approval_Order,data.id,Process_Title,Process_Description);   	    	 		editApproval_Process(role_id,1,role_name,"none","","","");   	    	 		setTimeout("showApprovalProcessUser('Approval_Process_div_Add_"+data.Approval_Order+"',"+data.id+",'"+Process_Title+"','"+Process_Description+"');",1000);   	    		 }else{   	    			 alert("插入失败！");   	    		 }   	    	 },error:function(e){	   	    		parent.location.reload();    	    				}	 });  }function reduceWidth(widthValue,type){	if(type == 1){		widthValue = widthValue - 1;		$("#Approval_Process_Show").css("width",widthValue+"%");		if(widthValue > 50){			setTimeout("reduceWidth("+widthValue+",1)", 10);		}		 showApprovalProcessUserOK = false;	}else{		widthValue = widthValue + 1;		$("#Approval_Process_Show").css("width",widthValue+"%");		if(widthValue < 100){			setTimeout("reduceWidth("+widthValue+",2)", 10);		}		 showApprovalProcessUserOK = true;	}}/** *审批流程详细展示  * */function processShow(id,className,type)    {		$("#insertRoleName").val("");		$("#insertDescription").val("");	 processClose('hidden',"");	 if(showApprovalProcessUserOK){		 setTimeout("reduceWidth(100,1)", 10);	 }	//判断是否有	 if(nextAdd){		 nextAdd = false;		 setTimeout("",1000);	 }	 if(type == 1){		 //显示追加流程的按钮		 $("#Approval_Process_Right_DIV_Title").html("追加审批流程");		 $("#Approval_Process_Right_Show").hide();		 $("#Approval_Process_div_Add").hide();		 $("#Approval_Process_Right_Add").show(500);	 }else if(type == 2){		//显示查看流程的按钮		$("#Approval_Process_Right_DIV_Title").html("编辑审批流程");		 $("#Approval_Process_Right_Add").hide();		 $("#Approval_Process_div_Add").show(500);		 $("#Approval_Process_Right_Show").show(500);	 }	 $("#Approval_Process_Right").show(1000);	 nextAdd = true;	 addClassCheck(id,className);	 $("#Approval_Process_Show").animate({ scrollTop: $("#Approval_Process_Show").scrollTop() + $('#'+id).offset().top - $("#Approval_Process_Show").offset().top }, 1000);	 $("#Approval_Process_Right_hidden_id").val(id);	 $("#Approval_Process_Right_hidden_className").val(className);  }  var nextAdd = false;  function addClassCheck(id,className){	  var className_old = $("#"+id).attr("class");	  $("#"+id).removeClass().addClass(className);	  $("#"+id).addClass(className_old);      removeOrAddClassCheck(id,className,false);  }  //定时任务  function removeOrAddClassCheck(id,className,ok){	   if(nextAdd){		   if(ok){			     ok = false;				 $("#"+id).removeClass(className);				 //setTimeout("removeOrAddClassCheck('"+id+"','"+className+"',"+ok+")", 500);			 }else{				 ok = true;				 var className_old = $("#"+id).attr("class");				  $("#"+id).removeClass().addClass(className);				  $("#"+id).addClass(className_old);				 //setTimeout("removeOrAddClassCheck('"+id+"','"+className+"',"+ok+")", 500);			 }	   }else{		   $("#"+id).removeClass(className);		   return;	   }	     }  function removeClassCheck(id,className){	  $("#"+id).removeClass(className);  }  /** * 展示审批流程 */function  editApproval_Process(role_id,method,role_name,approval_Order_Id,approval_Process_Group_ID,Process_Title_Show,Process_Description_Show) {	 $("#getForm").ajaxSubmit({   	     type: "post",   	     url: "/hssp/configTableController/showApprovalProcessGroup?role_id="+role_id+"&method="+method,   	     dataType: "json",   	     success: function(data){   	    	 if(data.result == "succeed"){   	    		 var list = eval(data.list);   	    		 var htmStart = "<li><div class=\"line\" style=\"height:40px\"><span id=\"Approval_Process_Span_Add_0\" class=\"jia\" onClick=\"processShow('Approval_Process_Span_Add_0','jiaChange',1)\" style=\"top:0\">+</span>				</div>			 </li>"   	    		var htmlAll = "";   	    		for(var k in list){   	    			var id = list[k]["Id"];   	   	    		var Process_Title = list[k]["Process_Title"];   	   	    		var Process_Description = list[k]["Process_Description"];   	   	    		var Approval_Order = list[k]["Approval_Order"];   	    			var html = "<li> <div class=\"list1\" id=\"Approval_Process_div_Add_"+Approval_Order+"\" onclick=\"showApprovalProcessUser('Approval_Process_div_Add_"+Approval_Order+"',"+id+",'"+Process_Title+"','"+Process_Description+"')\"> <div class=\"titel\" id=\"Approval_Process_div_Add_Title_"+Approval_Order+"";   	   	    		html = html +"\">"+Process_Title+"</div> <p id=\"Approval_Process_Add_Description_"+Approval_Order+"\">"+Process_Description+"</p>";   	   	    		html = html +"</div> <div class=\"line\"> <span class=\"jia\" id=\"Approval_Process_Span_Add_"+Approval_Order;   	   	    		html = html +"\" onClick=\"processShow('Approval_Process_Span_Add_"+Approval_Order+"','jiaChange',1)\" >+</span> </div> </li>"   	   	    	    htmlAll = htmlAll + html;   	    		 }   	    		$("#Approval_Process_ul_id").html(htmStart+htmlAll);   	    		$("#Approval_Process_Right_hidden_Role_id").val(role_id);   	    		$("#Approval_Process_Right_hidden_Role_name").val(role_name);   	    		if(approval_Order_Id != "none"){   	    			showApprovalProcessUser(approval_Order_Id,approval_Process_Group_ID,Process_Title_Show,Process_Description_Show);    	    		}   	    	 }else{   	    		alert("流程查询失败！");   	    	 }   	     },error:function(e){	    		parent.location.reload();    	    			}	 });	 $("#priRole_div").hide();	 $("#priUser_div_Adduser").hide();	 $("#Approval_Process_Show").show(500);	 $("#Approval_Process_Show").css("height", $(window).height());}/** * 角色下添加用户 * */function  addApprovalProcess_user(user_id,method) {	 $("#getForm").ajaxSubmit({   	     type: "post",   	     url: "/hssp/configTableController/addApprovalProcess_user?processGroupId="+$("#Approval_Process_Right_hidden_ApprovalProcessGroupID").val()+"&user_id="+user_id+"&method="+method,   	     dataType: "json",   	     success: function(data){   	    	 if(data.result == "succeed"){   	    		//parent.$.dialog("添加成功！", false, 1000);   	    		alert("添加成功！");   	    		//addApprovalProcessUser();   	    		$("#Approval_Process_Table_Add").bootstrapTable('refresh');   	    	 }else{   	    		//parent.$.dialog("添加失败！", false, 1000);   	    		alert("添加失败！");   	    	 }   	     },error:function(e){	    		parent.location.reload();    	    			}	 });}/** * 角色下用户查看，删除当前用户 * */function  deleteApprovalProcess_user(approvalProcess_id) {	 $("#getForm").ajaxSubmit({   	     type: "post",   	     url: "/hssp/configTableController/deleteApprovalProcess_user?approvalProcess_id="+approvalProcess_id,   	     dataType: "json",   	     success: function(data){   	    	if(data.result == "succeed"){   	    		//parent.$.dialog("删除成功！", false, 1000);   	    		alert("删除成功！");   	    		//showApprovalProcessUser();   	    		$("#Approval_Process_Table_Add").bootstrapTable('refresh');   	    	 }else{   	    		alert("删除失败！");   	    		//parent.$.dialog("删除失败！", false, 1000);     	    	 }   	     },error:function(e){	    		parent.location.reload();    	    			}	 });}/** * 刷新 */function refreshApprovalProcessUser(){	$("#Approval_Process_Table_Add").hide();	$("#Approval_Process_Table_Add").bootstrapTable('refresh');	$("#Approval_Process_Table_Add").show(1000);}/** * 展示某个流程的节点没有的人员 */function addApprovalProcessUser(searchNameForApproval){	$("#Approval_Process_Table_Add").hide();	searchUserForApprovalType = 2;	 $("#searchNameForApproval").val("");	initTable_ProcessUser($("#Approval_Process_Right_hidden_ApprovalProcessGroupID").val(), 2, "Approval_Process_Table_Add", "", searchNameForApproval, "Approval_Process_toolbar_add");	 $("#Approval_Process_Table_Add").show(1000);}/** * 展示某个流程的节点人员 */function reloadApprovalProcessUser(searchNameForApproval){	$("#Approval_Process_Table_Add").hide();	searchUserForApprovalType = 1;	 $("#searchNameForApproval").val("");	initTable_ProcessUser($("#Approval_Process_Right_hidden_ApprovalProcessGroupID").val(), 1, "Approval_Process_Table_Add", "", searchNameForApproval, "Approval_Process_toolbar_add");	 $("#Approval_Process_Table_Add").show(1000);}/** * 展示某个流程的节点人员 */ var showApprovalProcessUserOK = true;function  showApprovalProcessUser(id,approvalProcessGroupID,title,description) {	 //alert("需要展示id:"+id+" >> title:"+title+">> description:"+description);	 processShow(id,"listChange",2);	 $("#Approval_Process_Right_hidden_ApprovalProcessGroupID").val(approvalProcessGroupID);	 $("#Approval_Process_Right_Title").val(title);	 $("#Approval_Process_Right_Description").text(description);	 $("#priRole_div").hide();	 $("#priUser_div_Adduser").hide();	 $("#Approval_Process_Show").show(1000);	 $("#Approval_Process_Show").css("height", $(window).height());	 initTable_ProcessUser($("#Approval_Process_Right_hidden_ApprovalProcessGroupID").val(), 1, "Approval_Process_Table_Add", "", "", "Approval_Process_toolbar_add");	 $("#Approval_Process_div_Add").show(1000);}//用户信息准备页面function initTable_ProcessUser(processGroupId,method,tableId,userid,username,toolbarid) {        //先销毁表格        var columnNames = [];        $("#"+tableId).bootstrapTable('destroy');   			  columnNames.push({        	         title: "序号",        	         field: "rowNum",        	         valign:'middle',        	         align:'center',        	         formatter:function(value,row,index){   	 	              return index+1;    	 	             }         	     });   			  /*columnNames.push({        	         title: "编码",        	         field: "Id",        	         valign:'middle',        	         align:'center'        	     });*/   			  columnNames.push({          	         title: "用户ID",          	         field: "USERID",          	         valign:'middle',          	         align:'center'          	     }); 			  columnNames.push({       	         title: "用户名称",       	         field: "USERNAME",       	         valign:'middle',       	         align:'center'       	     }); 			  if(method == 1){				  //展示已有用户				 columnNames.push({	 				 title: '操作',	 	            field: 'operate',	 	            align: 'center',	 	            formatter:function(value,row,index){ 	 	            	//var a = "<a href=\"#\" mce_href=\"#\" onclick=\"getPriField('"+ row.Id +"')\">查看详情</a> ";	 	            	var e = "<a href=\"#\" mce_href=\"#\" onclick=\"deleteApprovalProcess_user('"+ row.id+"')\"  >删除</a> ";	 	              return e;  	 	          } 	 	 	     });			  }else if(method == 2){				  //展示没有的用户				 columnNames.push({	 				 title: '操作',	 	            field: 'operate',	 	            align: 'center',	 	            formatter:function(value,row,index){ 	 	            	//var a = "<a href=\"#\" mce_href=\"#\" onclick=\"getPriField('"+ row.Id +"')\">查看详情</a> ";	 	            	var e = "<a href=\"#\" mce_href=\"#\" onclick=\"addApprovalProcess_user('"+ row.id+"',2)\"  >添加</a> ";	 	              return e;  	 	          } 	 	 	     });			  }        	 //初始化表格,动态从服务器加载数据          $("#"+tableId).bootstrapTable({              url: "/hssp/configTableController/showApprovalProcessUser", //获取数据的Servlet地址           // method: "POST",  //使用get请求到服务器获取数据           // contentType: "application/x-www-form-urlencoded",//post请求的话就加上这个句话              toolbar: "#"+toolbarid,              striped: true,                      //是否显示行间隔色              cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）              pagination: true,                   //是否显示分页（*）              sortable: false,                     //是否启用排序              sortOrder: "asc",                   //排序方式              sidePagination: "server",           //分页方式：client客户端分页，server服务端分页（*）              pageNumber:1,                       //初始化加载第一页，默认第一页              pageSize: 5,                       //每页的记录行数（*）              pageList: [5],        			//可供选择的每页的行数（*）              search: false,                       //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大              strictSearch: false,              showColumns: false,                  //是否显示所有的列              showRefresh: false,                  //是否显示刷新按钮              minimumCountColumns: 2,             //最少允许的列数              clickToSelect: true,                //是否启用点击选中行              height: "",                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度              uniqueId: "id",                     //每一行的唯一标识，一般为主键列              showToggle:false,                    //是否显示详细视图和列表视图的切换按钮              cardView: false,                    //是否显示详细视图              detailView: false,                   //是否显示父子表              queryParams: function queryParams(params) {   //设置查询参数                var param = {                      pageNumber: params.offset,                      pageSize: params.limit,                    method : method,                    flagDicDb:0,                    processGroupId:processGroupId,                    userId:userid,                    userName:username                };                  return param;                               },                           formatLoadingMessage: function () {                  return "请稍等，正在加载中...";              },              formatNoMatches: function () {  //没有匹配的结果                  return '无符合条件的记录';              },               columns : columnNames,           	  responseHandler: function(data){           		//alert(JSON.stringify(data));           	 	return data;           	 }            });       	       }/***************权限审批流程用户追加***********************/ /** * 搜索未分配角色的用户  */function addRole_user_search() {	initTable_user($("#role_id").val(),5,"priUserTable_Add",$("#search_userId").val(),$("#search_userName").val(),"toolbarPriField_add");}/** * 搜索已分配角色的用户  */function searchUser(method) {	$("#priRole_div").hide();	initTable_user($("#role_id").val(),method,"priUserTable",$("#searchUserId").val(),$("#searchUserName").val(),"toolbarPriField_show");    $("#priUser_div").show();}/** * 返回角色页面 */function  showPriRole(hideID,showID) {	  $("#"+hideID).hide();	  $("#"+showID).show();}/** * 添加用户返回角色下用户查看 */function  return_ShowRole_user() {	  $("#priUser_div_Add").hide();	  getUser_role($("#role_id").val(),3,$("#Add_role_name").text());}/** * 角色下添加用户 * */function  addRole_user(user_id,method) {	 $("#getForm").ajaxSubmit({   	     type: "post",   	     url: "/hssp/configTableController/AddRole_user?role_id="+$("#role_id").val()+"&user_id="+user_id+"&method="+method,   	     dataType: "json",   	     success: function(data){   	    	 if(data.result == "succeed"){   	    		//parent.$.dialog("添加成功！", false, 1000);   	    		alert("添加成功！");   	    		addRole_user_Select(method);   	    	 }else{   	    		//parent.$.dialog("添加失败！", false, 1000);   	    		alert("添加失败！");   	    	 }   	     },error:function(e){	    		parent.location.reload();    	    			}	 });}/** * 角色下用户查看，删除当前用户 * */function  deleteRole_user(role_user_id) {	 $("#getForm").ajaxSubmit({   	     type: "post",   	     url: "/hssp/configTableController/deleteRole_user?Role_user_id="+role_user_id,   	     dataType: "json",   	     success: function(data){   	    	if(data.result == "succeed"){   	    		//parent.$.dialog("删除成功！", false, 1000);   	    		alert("删除成功！");   	    		getUser_role($("#role_id").val(),3,$("#Add_role_name").text());   	    	 }else{   	    		alert("删除失败！");   	    		//parent.$.dialog("删除失败！", false, 1000);     	    	 }   	     },error:function(e){	    		parent.location.reload();    	    			}	 });}//用户信息准备页面function initTable_user(role_id,method,tableId,userid,username,toolbarid) {        //先销毁表格        var columnNames = [];        $("#"+tableId).bootstrapTable('destroy');   			  columnNames.push({        	         title: "序号",        	         field: "rowNum",        	         valign:'middle',        	         align:'center',        	         formatter:function(value,row,index){   	 	              return index+1;    	 	             }         	     });   			  /*columnNames.push({        	         title: "编码",        	         field: "Id",        	         valign:'middle',        	         align:'center'        	     });*/   			  columnNames.push({          	         title: "用户ID",          	         field: "USERID",          	         valign:'middle',          	         align:'center'          	     }); 			  columnNames.push({       	         title: "用户名称",       	         field: "USERNAME",       	         valign:'middle',       	         align:'center'       	     }); 			   			if(method == 3){ 				 /* columnNames.push({ 	       	         title: "可否审批", 	       	         field: "Approval_OK", 	       	         valign:'middle', 	       	         align:'center', 	       	         formatter:function(value,row,index){ 	       	        	 var e = "<select id=\"select_Approval_id_"+row.Id+"\" onchange=\"updateApproval("+row.Id+")\">"; 	       	        	  if(row.Approval_OK == 0){ 	       	        		  e = e +"<option value=\"0\">否"; 	       	        	 	 e = e +"</option>"; 	       	        	 	 e = e +"<option value=\"1\">是"; 	       	        	 	 e = e +"</option>";  	       	        	 }else if(row.Approval_OK == 1){ 	       	        		  e = e +"<option value=\"0\">否"; 	       	        	 	 e = e +"</option>"; 	       	        	 	 e = e +"<option value=\"1\">是"; 	       	        	 	 e = e +"</option>";  	       	        	 }  	       	        	 	 e = e +row.Approval_OK+"</select>";  	 	              return e;    	 	          }  	       	     }); */ 	       	     columnNames.push({ 	       	         title: "权限类型", 	       	         field: "Approval_OK", 	       	         valign:'middle', 	       	         align:'center', 	       	         formatter:function(value,row,index){ 	       	        	/*  if(row.Approval_OK == 0){ 	       	        		 var e = "<a href=\"#\" mce_href=\"#\" onclick=\"update_approval_user('"+ row.Id+"')\"  >是</a> "; 	       	        	 }else if(row.Approval_OK == 1){ 	       	        		 var e = "<a href=\"#\" mce_href=\"#\" onclick=\"update_approval_user('"+ row.Id+"')\"  >否</a> "; 	       	        	 } */ 	       	        	 var e = "<select id=\"select_Privilege_Type_id_"+row.Id+"\" onchange=\"updatePrivilege_Type("+row.Id+")\">"; 	       	        	  if(row.Privilege_Type == 0){ 	       	        		  e = e +"<option value=\"0\">永久权限"; 	       	        	 	 e = e +"</option>"; 	       	        	 	 e = e +"<option value=\"1\">临时权限"; 	       	        	 	 e = e +"</option>";  	       	        	 }else if(row.Privilege_Type == 1){ 	       	        	 	 e = e +"<option value=\"1\">临时权限"; 	       	        	 	 e = e +"</option>";  	       	        		   e = e +"<option value=\"0\">永久权限"; 	       	        	 	 e = e +"</option>"; 	       	        	 }  	       	        	 	 e = e +row.Approval_OK+"</select>";  	 	              return e;    	 	          }  	       	     });	 			  columnNames.push({				       	         title: "权限开始时间",				       	         field: "valid_startTime",				       	         valign:'middle',				       	         align:'center',			 	       	         formatter:function(value,row,index){			 	       	        	 var e = "<span>";			 	       	        	  if(row.Privilege_Type == 0){			 	       	        	  	e = e +row.UpdateTime; 			 	       	        	 }else if(row.Privilege_Type == 1){			 	       	        	 	 e = e +row.valid_startTime; 			 	       	        	 } 			 	       	        	 e = e + "</span>";			  	 	              return e;  			  	 	          } 				       	     });	 			  columnNames.push({				       	         title: "权限结束时间",				       	         field: "valid_EndTime",				       	         valign:'middle',				       	         align:'center',			 	       	         formatter:function(value,row,index){			 	       	        	var e = "<span>";			 	       	        	  if(row.Privilege_Type == 0){		 	       	        	  		e = e +row.UpdateTime; ;			 	       	        	 }else if(row.Privilege_Type == 1){			 	       	        	 	 e = e +row.valid_EndTime; ;			 	       	        	 } 			 	       	        	  e = e + "</span>";			  	 	              return e;  			  	 	          } 				       	     }); 				 columnNames.push({ 	 				 title: '操作', 	 	            field: 'operate', 	 	            align: 'center', 	 	            formatter:function(value,row,index){  	 	            	//var a = "<a href=\"#\" mce_href=\"#\" onclick=\"getPriField('"+ row.Id +"')\">查看详情</a> "; 	 	            	var e = "<a href=\"#\" mce_href=\"#\" onclick=\"deleteRole_user('"+ row.Id+"')\"  >删除</a> "; 	 	              return e;   	 	          }  	 	 	     }); 			}else if(method == 4 || method == 5){ 				columnNames.push({	 				 title: '操作',	 	            field: 'operate',	 	            align: 'center',	 	            formatter:function(value,row,index){ 	 	            	//var a = "<a href=\"#\" mce_href=\"#\" onclick=\"getPriField('"+ row.Id +"')\">查看详情</a> ";	 	            	var e = "<a href=\"#\" mce_href=\"#\" onclick=\"addRole_user('"+ row.Id+"')\"  >添加</a> ";	 	              return e;  	 	          } 	 	 	     }); 			}       	 //初始化表格,动态从服务器加载数据          $("#"+tableId).bootstrapTable({              url: "/hssp/configTableController/getConfigInfo", //获取数据的Servlet地址           // method: "POST",  //使用get请求到服务器获取数据           // contentType: "application/x-www-form-urlencoded",//post请求的话就加上这个句话              toolbar: "#"+toolbarid,              striped: true,                      //是否显示行间隔色              cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）              pagination: true,                   //是否显示分页（*）              sortable: false,                     //是否启用排序              sortOrder: "asc",                   //排序方式              sidePagination: "client",           //分页方式：client客户端分页，server服务端分页（*）              pageNumber:1,                       //初始化加载第一页，默认第一页              pageSize: 10,                       //每页的记录行数（*）              pageList: [5, 10],        			//可供选择的每页的行数（*）              search: false,                       //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大              strictSearch: true,              showColumns: false,                  //是否显示所有的列              showRefresh: false,                  //是否显示刷新按钮              minimumCountColumns: 2,             //最少允许的列数              clickToSelect: true,                //是否启用点击选中行              height: "",                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度              uniqueId: "ID",                     //每一行的唯一标识，一般为主键列              showToggle:false,                    //是否显示详细视图和列表视图的切换按钮              cardView: false,                    //是否显示详细视图              detailView: false,                   //是否显示父子表              queryParams: function queryParams(params) {   //设置查询参数                var param = {                      pageNumber: params.offset+1,                      pageSize: params.limit,                    grade : method,                    flagDicDb:0,                    RoleId:role_id,                    userId:userid,                    userName:username                };                  return param;                               },                           formatLoadingMessage: function () {                  return "请稍等，正在加载中...";              },              formatNoMatches: function () {  //没有匹配的结果                  return '无符合条件的记录';              },               columns : columnNames,             	responseHandler: function(data){             		return data.rows;             	}            });      }//更新用户是否可以审批      function updatePrivilege_Type(Privilege_User_Role_id) {    if($("#select_Privilege_Type_id_"+Privilege_User_Role_id).val() == 0){        }else if($("#select_Privilege_Type_id_"+Privilege_User_Role_id).val() == 1){        }    $("#getForm").ajaxSubmit({   	     type: "post",   	     url: "/hssp/configTableController/updatePrivilege_Type?Privilege_User_Role_id="+Privilege_User_Role_id+"&Privilege_Type="+$("#select_Privilege_Type_id_"+Privilege_User_Role_id).val(),   	     dataType: "json",   	     success: function(data){   	    	if(data.result == "succeed"){   	    		//parent.$.dialog("删除成功！", false, 1000);   	    		alert("权限类型修改成功！");   	    	 }else{   	    		alert("权限类型修改失败！");   	    		//parent.$.dialog("删除失败！", false, 1000);     	    	 }   	     },error:function(e){	    		parent.location.reload();    	    			}	 });}//更新用户是否可以审批      function updateApproval(Privilege_User_Role_id) {    $("#getForm").ajaxSubmit({   	     type: "post",   	     url: "/hssp/configTableController/updateApproval?Privilege_User_Role_id="+Privilege_User_Role_id+"&Approval_OK="+$("#select_Approval_id_"+Privilege_User_Role_id).val(),   	     dataType: "json",   	     success: function(data){   	    	if(data.result == "succeed"){   	    		//parent.$.dialog("删除成功！", false, 1000);   	    		alert("权限修改成功！");   	    	 }else{   	    		alert("权限修改失败！");   	    		//parent.$.dialog("删除失败！", false, 1000);     	    	 }   	     },error:function(e){	    		parent.location.reload();    	    			}	 });} //角色信息维护页面     function initTable_Role(isdeleted,Id,roleName,roleDescription) {		$("#hid_isDeleted").val(isdeleted);		if(isdeleted==0){       		$("#addRole").show();       		$("#hsz").show();       		$("#yxlb").hide();       	}else{       		$("#yxlb").show();       		$("#addRole").hide();       		$("#hsz").hide();       	}        //先销毁表格        var columnNames = [];        $('#priRoleTable').bootstrapTable('destroy');       	 //初始化表格,动态从服务器加载数据          $("#priRoleTable").bootstrapTable({              url: "/hssp/configTableController/getPrivilege_Role", //获取数据的Servlet地址           // method: "POST",  //使用get请求到服务器获取数据           // contentType: "application/x-www-form-urlencoded",//post请求的话就加上这个句话          	  toolbar: "#toolbarPriFieldRole",              striped: true,                      //是否显示行间隔色              cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）              pagination: true,                   //是否显示分页（*）              sortable: false,                     //是否启用排序              sortOrder: "asc",                   //排序方式              sidePagination: "client",           //分页方式：client客户端分页，server服务端分页（*）              pageNumber:1,                       //初始化加载第一页，默认第一页              pageSize: 10,                       //每页的记录行数（*）              pageList: [5, 10],        			//可供选择的每页的行数（*）              search: false,                       //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大              strictSearch: true,              showColumns: false,                  //是否显示所有的列              showRefresh: false,                  //是否显示刷新按钮              minimumCountColumns: 2,             //最少允许的列数              clickToSelect: true,                //是否启用点击选中行              height: "",                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度              uniqueId: "ID",                     //每一行的唯一标识，一般为主键列              showToggle:false,                    //是否显示详细视图和列表视图的切换按钮              cardView: false,                    //是否显示详细视图              detailView: false,                   //是否显示父子表              queryParams: function queryParams(params) {   //设置查询参数                var param = {                      pageNumber: params.offset+1,                      pageSize: params.limit,                    isDeleted:isdeleted,                    ID:Id,                    roleName:roleName,                    roleDescription:roleDescription,                    method:1                };                  return param;                               },                           formatLoadingMessage: function () {                  return "请稍等，正在加载中...";              },              formatNoMatches: function () {  //没有匹配的结果                  return '无符合条件的记录';              },               columns : [{			     	         title: "序号",			    	         field: "rowNum",			    	         valign:'middle',			    	         align:'center',			    	         formatter:function(value,row,index){ 				 	              return index+1;  				 	         } 				    	  },   	    		 		 {   	              	         title: "角色名称",   	              	         field: "RoleName",   	              	         valign:'middle',   	              	         align:'center'   	              	     },   	              	     {   	            	         title: "角色描述",   	            	         field: "Description",   	            	         valign:'middle',   	            	         align:'center'   	            	     },   	            	     {	   	         			 title: '操作',		   	                 field: 'operate',		   	                 align: 'center',		   	                 formatter:function(value,row,index){ 		   	                 	if(isdeleted==0){		   	                 		var approval_Process = "<a href=\"#\" mce_href=\"#\" onclick=\"editApproval_Process('"+ row.Id +"',"+1+",'"+row.RoleName+"','none','','','')\">审批设置</a> ";		   	                 		var a = "<a href=\"#\" mce_href=\"#\" onclick=\"getUser_role('"+ row.Id +"',"+3+",'"+row.RoleName+"')\">查看用户</a> ";			   	                 	var b = "<a href=\"#\" mce_href=\"#\" onclick=\"showPrivilegeColumnItem('"+ row.Id +"')\">分配列权限</a>  ";			   	                  	var c = "<a href=\"#\" mce_href=\"#\" onclick=\"showRoleForPrivilegeRow('"+ row.Id +"','"+ row.RoleName +"')\">分配行权限</a> ";			   	                  	var e = "<a href=\"#\" mce_href=\"#\" onclick=\"edit_privilege_user('"+ row.Id+"','"+ row.RoleName +"','"+ row.Description +"')\"  >编辑</a> ";			   	                  	var s = "<a href=\"#\" mce_href=\"#\" onclick=\"restorePrivilegeRole('"+ row.Id+"',"+1+")\"  >删除</a> ";			   	                 	return approval_Process+a+b+c+e+s;		   	                 	}else{		   	                 		var d = "<a href=\"#\" mce_href=\"#\" onclick=\"restorePrivilegeRole('"+ row.Id+"',"+0+")\"  >恢复</a> ";			   	                 	return d;		   	                 	}		   	                  	  	   	                	}   	            	     }               			],             	responseHandler: function(data){             		return data.rows;             	}            });      }    //角色新增     function addPrivilegeRole(){    	$("#insertRole").modal();    }        function saveRole(){    	var reg = new RegExp(" ","g");		var roleName = $("#insertRoleName").val().replace(reg,"");    	var description = $("#insertDescription").val();		if(roleName == ""){			alert("角色名称不能为空!");			return;		}		var datas = {				roleName : roleName,				description : description    	};		 $.ajax({ 	        type:"POST", 	        url:"/hssp/configTableController/insertRole", 	        dataType: "json", 	        data:datas, 	        cache: false,	        async : false, 	        success:function(result){ 	        	if (result.status == "succeed"){ 	        		$("#insertRoleName").val(""); 	       			$("#insertDescription").val(""); 	        		alert("新增成功!"); 	        	}			} 	    });		queryRole(0);		    }        //修改角色    function edit_privilege_user(id,roleName,description){    	$("#role_id").val(id);    	$("#updateRoleName").val(roleName);		$("#updateDescription").val(description);		$("#updateRole").modal();    }    //保存修改角色    function updatePrivilegeRole(){    	var id = $("#role_id").val();    	var roleName = $("#updateRoleName").val();		var description = $("#updateDescription").val();		if(roleName ==""){			alert("角色名称不能为空!");			return;		}    	var datas = {	    	id : id,	    	roleName : roleName,	    	description : description    	}; 	    $.ajax({ 	        type:"POST", 	        url:"/hssp/configTableController/updatePrivilegeRole", 	        dataType: "json", 	        data:datas, 	        cache: false,	        async : false, 	        success:function(result){ 	        	if (result.status == "succeed"){ 	        		alert("该角色修改成功!"); 	        	}			} 	    });		queryRole(0);    }        //删除恢复角色    function restorePrivilegeRole(id,isDeleted){    	var datas = {	    	id : id,	    	isDeleted : isDeleted    	};		 $.ajax({ 	        type:"POST", 	        url:"/hssp/configTableController/deletePrivilegeRole", 	        dataType: "json", 	        data:datas, 	        cache: false,	        async : false, 	        success:function(result){ 	        	if (result.status == "succeed" && isDeleted=="0"){ 	        		alert("该角色设置恢复成功，请在有效列表查看!"); 	        	} 	        	if (result.status == "succeed" && isDeleted=="1"){ 	        		alert("该角色设置删除成功，可以在回收站恢复!"); 	        	}			} 	    }); 	    if(isDeleted=="0"){			queryRole(1); 	    }else{			queryRole(0); 	    }    }//**************************列级权限明细***********开始*************************** //列权限分配展示框    function showPrivilegeColumnItem(id){    	$("#showPrivilegeColumnItem_Label").text("权限分配");    	$("#role_id").val(id);    	getSolrDBFieldInfo(id);	    $("#showPrivilegeColumnItem").modal();    }        //列权限树展示	function getSolrDBFieldInfo(id)	{		var datas = {privilegeColumnId:id};		$.ajax({			type : "post",			url : "/hssp/configTableController/getDicFieldTree",			dataType : "json",			data:datas,			success : function(result)			{				var windows_height = $(window).height()*0.5;				$("#solrTableAndFieldTree").css({					height:windows_height,					});				if(result.getSolrReturn.length > 2){					treeNodes_solr = result.getSolrReturn;						solrTableAndFieldDisplay();				}else{					alert("列级权限字段获取失败，请联系系统管理员！");				}			}		});	}	//返回字段树结构	var setting_solr = {			data : {				simpleData : {					enable : true,					idKey : "id",					pIdKey : "pId",					rootPId : 0				},				key : {					name : 'name',				}			},			check : {				enable : true,				chkStyle : "checkbox",				chkboxType : {					"Y" : "ps",					"N" : "ps"				}			}		};			var treeNodes_solr;      	function return_search_cancel(){		$("#showPrivilegeColumnItem").modal('hide');		 /*  $("#return_search").hide();		  $("#return_search_form_id").val("1"); */	}		function solrTableAndFieldDisplay() {  	    $("#return_search").hide();		zTree_solr = $.fn.zTree.init($("#solrTableAndFieldTree"),setting_solr, treeNodes_solr);  	    $("#return_search").show();	 }    //权限树提交    function return_search_submit(){    	var tableAndField = "";		var nodeList = zTree_solr.getNodes();		var nodeArr = zTree_solr.transformToArray(nodeList);		var numCheck =0 ;		var tableName = "";		for (var i = 0,size = nodeArr.length; i < size; i++)		{			if (nodeArr[i].pId != 0 && nodeArr[i].checked)			{				numCheck++;				if (tableAndField == "")					tableAndField = tableAndField + nodeArr[i].tableId + ":" + nodeArr[i].fieldId;											else												tableAndField = tableAndField + "," + nodeArr[i].tableId + ":" + nodeArr[i].fieldId;			}		}				    var privilegeColumnId =$("#role_id").val();		var datas = {				privilegeColumnId:privilegeColumnId,				tableAndField:tableAndField    	};		 $.ajax({ 	        type:"post", 	        url:"/hssp/configTableController/insertPrivilegeColumnItem", 	        dataType: "json", 	        data:datas, 	        cache: false,	        async : true, 	        success : function(result){			  if (result.status == "succeed"){				 alert("列权限设置成功!");				 $("#showPrivilegeColumnItem").modal('hide');			  }else{			  	 alert("列权限设置失败!");			  }			  //searchPrivilegeColumn();			} 	    });    }     //**************************列级权限明细***********结束***************************          //**************************行级权限***********开始***************************		 //权限行权限配置展示     function showRoleForPrivilegeRow(id,roleName) {     	  $("#role_id").val(id);     	  $("#hid_roleName").val(roleName);     	  $("#Row_role_name").text(roleName);     	  $("#Add_Row_role_name").text(roleName);     	  $("#priRole_div").hide();    	  getRoleForPrivilegeRow(id,"priPrivilegeRowTable","toolbarRolePrivilegeRow","show","");     	  $("#rolePrivilegeRow").show();	 }     //权限行权限     function getRoleForPrivilegeRow(id,tableId,toolbar,method,rowName) {    	//先销毁表格         $("#"+tableId).bootstrapTable('destroy');        	 //初始化表格,动态从服务器加载数据           $("#"+tableId).bootstrapTable({               url: "/hssp/configTableController/getRoleForPrivilegeRow", //获取数据的Servlet地址               method: "POST",  //使用get请求到服务器获取数据               contentType: "application/x-www-form-urlencoded",//post请求的话就加上这个句话               toolbar: "#"+toolbar,				 //工具按钮用哪个容器               striped: true,                      //是否显示行间隔色               cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）               pagination: true,                   //是否显示分页（*）               sortable: false,                     //是否启用排序               sortOrder: "asc",                   //排序方式               sidePagination: "client",           //分页方式：client客户端分页，server服务端分页（*）               pageNumber:1,                       //初始化加载第一页，默认第一页               pageSize: 10,                       //每页的记录行数（*）               pageList: [5, 10],        			//可供选择的每页的行数（*）               search: false,                       //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大               strictSearch: true,               showColumns: false,                  //是否显示所有的列               showRefresh: false,                  //是否显示刷新按钮               minimumCountColumns: 2,             //最少允许的列数               clickToSelect: true,                //是否启用点击选中行               height: "",                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度               uniqueId: "ID",                     //每一行的唯一标识，一般为主键列               showToggle:false,                    //是否显示详细视图和列表视图的切换按钮               cardView: false,                    //是否显示详细视图               detailView: false,                   //是否显示父子表               queryParams: function queryParams(params) {   //设置查询参数                 var param = {              		 pageNumber: params.offset+1,                       pageSize: params.limit,                     roleId : id,                     rowName : rowName,                     method:method                 };                   return param;                                },                             formatLoadingMessage: function () {                   return "请稍等，正在加载中...";               },               formatNoMatches: function () {  //没有匹配的结果                   return '无符合条件的记录';               },                columns : [{ 			     	         title: "序号", 			    	         field: "rowNum", 			    	         valign:'middle', 			    	         align:'center', 			    	         formatter:function(value,row,index){  				 	              return index+1;   				 	         }  				    	  },	 				    	{		                        title: '权限名称',		                        field: 'Row_Name',		                        align: 'center',		                        valign: 'middle',		                    }, 	 				    	{		                        title: '表名称',		                        field: 'tableName',		                        align: 'center',		                        valign: 'middle',		                    }, 		                    {		                        title: '列权限名称',		                        field: 'DisplayName',		                        align: 'center',		                        valign: 'middle',		                    }, 		                    {		                        title: '限制值',		                        field: 'Dic_Field_Value',		                        align: 'center',		                        valign: 'middle',		                    }, 		                    {		                      title: '说明',		                        field: 'Description',		                        align: 'center',		                        valign: 'middle'		                    }, 		                    {		                      title: '限制类型',		                        field: 'Privilege_Status',		                        align: 'center',		                        formatter:function(value,row,index){		                        	if (value == '1') {					                    return "固定值";					                } else {					                    return "动态值";					                }  		                        } 		                    },                            {                                title: '操作',                                field: 'operate',                                align: 'center',                                formatter:function(value,row,index){                                 	  if(method == "show"){                               		  var b = '<a href="#" mce_href="#" onclick="deletePrivilegeRoleRow(\''+ row.Id +'\')">删除</a> ';                                  	    return b;                               	  }else if(method == "Add"){                               		  var b = '<a href="#" mce_href="#" onclick="insertPrivilegeRoleRow(\''+ row.Id +'\')">添加</a> ';                                	    return b;                             	  }                              }                             }               			],              	responseHandler: function(data){              		return data.rows;              	}             });       }	             //新增角色权限行级权限展示框      function showAddRolePrivilegeRow(){      	  $("#rowName").val("");      	  var rowName = $("#addRoW_rowName").val();     	  $("#rolePrivilegeRow").hide();    	  getRoleForPrivilegeRow($("#role_id").val(),"priPrivilegeRowTable_Add","toolbarPriRolePrivilegeRow_Add","Add",rowName);     	  $("#rolePrivilegeRow_Add").show();      }            //新增角色权限行级权限返回上一级      function showRolePrivilegeRow(){          $("#addRoW_rowName").val("");      	  var id = $("#role_id").val();     	  var roleName = $("#hid_roleName").val();     	  var rowName = $("#rowName").val();     	  $("#Row_role_name").text(roleName);     	  $("#Add_Row_role_name").text(roleName);     	  $("#rolePrivilegeRow_Add").hide();    	  getRoleForPrivilegeRow(id,"priPrivilegeRowTable","toolbarRolePrivilegeRow","show",rowName);     	  $("#rolePrivilegeRow").show();      }            //删除角色行级限制      function deletePrivilegeRoleRow(id){    	 var datas = {	    	id : id    	 };		 $.ajax({ 	        type:"POST", 	        url:"/hssp/configTableController/deletePrivilegeRoleRow", 	        dataType: "json", 	        data:datas, 	        cache: false,	        async : false, 	        success:function(result){ 	        	if (result.status == "succeed"){ 	        		alert("删除成功!"); 	        	}else{ 	        		alert("删除失败!"); 	        	}			} 	    }); 	    showRolePrivilegeRow();    }        //新增角色行级限制    function insertPrivilegeRoleRow(privilegeRowId){    	 var roleId = $("#role_id").val();    	 var datas = {	    	roleId : roleId,	    	privilegeRowId : privilegeRowId    	 };		 $.ajax({ 	        type:"POST", 	        url:"/hssp/configTableController/insertPrivilegeRoleRow", 	        dataType: "json", 	        data:datas, 	        cache: false,	        async : false, 	        success:function(result){ 	        	if (result.status == "succeed"){ 	        		alert("新增成功，可在上一级查看明细!"); 	        	}else{ 	        		alert("新增失败，请重新操作或联系系统管理员!"); 	        	}			} 	    }); 	    showAddRolePrivilegeRow();    }        //获取所有角色信息    function queryRole(isDeleted){		$("#search_roleName").val("");		$("#search_roleDescription").val("");		initTable_Role(isDeleted,"","","");	}    //角色查询带条件    function roleSearch(){   		var isDeleted=$("#hid_isDeleted").val();   		var roleName = $("#search_roleName").val();   		var roleDescription= $("#search_roleDescription").val()    	initTable_Role(isDeleted,"",roleName,roleDescription);    }</script></html> 	