<%@ page language="java" contentType="text/html; charset=UTF-8"    pageEncoding="UTF-8"%><!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Insert title here</title><link rel="stylesheet" type="text/css" href="${pageContext.request.contextPath}/resources/css/basictable.css" />        <link rel="icon" href="${pageContext.request.contextPath}/resources/images/logo ico.png">        <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/Css/bootstrap-3.2.0/bootstrap-theme.min.css" />    <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/Css/bootstrap-3.2.0/bootstrap.min.css" />        <!--  <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/Css/bootstrap-3.3.5-dist/css/bootstrap.css" />    <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/Css/bootstrap-3.3.5-dist/css/bootstrap-theme.css" />-->        <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/Css/css_config.css"  />    <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/Css/jquery-ui-1.11.2.custom/jquery-ui.css" />    <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/Css/coverage.css" />    <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/css/Css/bootstrap-table-fixed-columns.css">    <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/js/Scriptsbybs/bootstrap-table-develop/dist/bootstrap-table.min.css">      <script src="${pageContext.request.contextPath}/resources/js/Scriptsbybs/jquery-2.1.1.min.js"></script>    <script src="${pageContext.request.contextPath}/resources/css/Css/bootstrap-3.3.5-dist/js/bootstrap.min.js"></script>	<script src="${pageContext.request.contextPath}/resources/js/Scriptsbybs/bootstrap-treeview-dist/bootstrap-treeview.min.js"></script>    <script src="${pageContext.request.contextPath}/resources/js/Scriptsbybs/bootstrap-table-develop/dist/bootstrap-table.min.js"></script>    <script src="${pageContext.request.contextPath}/resources/js/Scriptsbybs/bootstrap-table-develop/dist/locale/bootstrap-table-zh-CN.js"></script>   	<script src="${pageContext.request.contextPath}/resources/js/js/jquery.validate.js"></script>	<script src="${pageContext.request.contextPath}/resources/js/js/jquery.form.js"></script>	 <script src="${pageContext.request.contextPath}/resources/js/Scriptsbybs/jquery-ui-1.11.2.custom/jquery-ui.js"></script>	 <script type="text/javascript" src="${pageContext.request.contextPath}/resources/js/js/jquery.basictable.min.js"></script>	 <link rel="stylesheet" href="${pageContext.request.contextPath}/resources/clinbrain/ztree/zTreeStyle.css" />	<script src="${pageContext.request.contextPath}/resources/clinbrain/ztree/jquery.ztree.all.js"></script>	</head><body>	<!-- 表头按钮展示 -->	<div id="priUser_div"  style=" height:100%; width:100%; overflow:auto; float:left;">		<div id="toolbarPriField" class="btn-group">			<button id="addUser" type="button" class="btn btn-primary"  onclick="add_privilege_user('new')">	            <span class="glyphicon glyphicon-plus" aria-hidden="true" ></span>新增	        </button>	        <button  type="button" class="btn btn-primary" id="hsz" onclick="queryUser('1')">                <span class="glyphicon glyphicon-trash" aria-hidden="true" ></span>回收站            </button>                        <button  type="button" class="btn btn-primary" id="yxlb" style="display: none;"  onclick="queryUser('0')">                <span class="glyphicon glyphicon-trash" aria-hidden="true" ></span>返回有效列表            </button>            <span style="float: left; line-height: 34px;">用户id：</span><input id="search_userId" class="form-control" style="float: left;width: 140px;"/>			<span style="float: left; line-height: 34px;">用户名称：</span><input id="search_userName" class="form-control" style="float: left;width: 140px;"/> 		    <button onclick="user_search()" class="btn btn-primary">检索</button>	    </div>		<table  id="priUserTable"></table>	</div>	<!-- 新增修改展示 -->	<div class="modal fade" id="myModal_privilege_user_submit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel">        <div class="modal-dialog" role="document">            <div class="modal-content">                <div class="modal-header">                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>                    <h4 class="modal-title" id="myModal_privilege_user_submit_message">用户信息修改</h4>                </div>                <div class="modal-body" id="myModal_privilege_user_html">                                    </div>                <div class="modal-footer">                    <button type="button" class="btn btn-primary" data-dismiss="modal"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span>关闭</button>                    <button type="button" id="btn_submit" class="btn btn-primary" data-dismiss="modal" onclick="saveUser()"><span class="glyphicon glyphicon-floppy-disk" aria-hidden="true"></span>保存</button>                </div>            </div>        </div>    </div>    <div id="hiddenInfo" style="display: none">		<form id="getForm">			<input type="text" name="hid_userId" id="hid_userId" />			<input type="text" name="hid_isDeleted" id="hid_isDeleted" />		</form>	</div>	</body><script type="text/javascript">$(document).ready(function () {            //调用函数，初始化表格    queryUser(0);    //当点击查询按钮的时候执行	document.getElementById('priUser_div').style.display='block';       // $("#search").bind("click", initTable(0));});function queryUser(isDeleted){	$("#search_userId").val("");	$("#search_userName").val("");	initTable(isDeleted,"","");}//用户信息准备页面function initTable(isDeleted,userid,username) {      $("#hid_isDeleted").val(isDeleted);	  if(isDeleted==0){     	 $("#addUser").show();     	 $("#hsz").show();     	 $("#yxlb").hide();       }else{   		 $("#yxlb").show();   		 $("#addUser").hide();   		 $("#hsz").hide();   	  }      //先销毁表格      var columnNames = [];      columnNames.push({	         title: "序号",	         field: "rowNum",	         valign:'middle',	         align:'center',	         formatter:function(value,row,index){                 return index+1;               } 	     });      $('#priUserTable').bootstrapTable('destroy');      $("#getForm").ajaxSubmit({   	     type: "post",   	     url: "/hssp/configTableController/getFieldNames",   	     dataType: "json",   	     success: function(data){   	    	for ( var key in data.field_description) {   	    		if(key == "Id"){         			           		  }else if(key == "USERID"){       			  columnNames.push({              	         title: "用户ID",              	         field: key,              	         valign:'middle',              	         align:'center'              	     });       		  }else if(key == "USERNAME"){     			  columnNames.push({           	         title: "用户名称",           	         field: key,           	         valign:'middle',           	         align:'center'           	     });      		  }else{      			columnNames.push({      	         title: data.field_description[key],      	         field: key,      	         valign:'middle',      	         align:'center'      	    	 });      		  }       	  };       	 columnNames.push({			 title: '操作',            field: 'Id',            align: 'center',            formatter:function(value,row,index){            	if(isDeleted==0){	            	var a = "<a href=\"#\" mce_href=\"#\" onclick=\"edit_privilege_user('"+ row.Id+"')\">修改</a> ";	            	var e = "<a href=\"#\" mce_href=\"#\" onclick=\"restoreUser('"+ row.Id +"',"+1+")\">删除</a> ";              		return a+e;               	}else{               		var d = "<a href=\"#\" mce_href=\"#\" onclick=\"restoreUser('"+ row.Id+"',"+0+")\">恢复</a> ";                	return d;               	}           }  	     });       	 //初始化表格,动态从服务器加载数据          $("#priUserTable").bootstrapTable({              url: "/hssp/configTableController/getConfigInfo", //获取数据的Servlet地址           // method: "POST",  //使用get请求到服务器获取数据           // contentType: "application/x-www-form-urlencoded",//post请求的话就加上这个句话          	  toolbar: "#toolbarPriField",              striped: true,                      //是否显示行间隔色              cache: false,                       //是否使用缓存，默认为true，所以一般情况下需要设置一下这个属性（*）              pagination: true,                   //是否显示分页（*）              sortable: false,                     //是否启用排序              sortOrder: "asc",                   //排序方式              sidePagination: "client",           //分页方式：client客户端分页，server服务端分页（*）              pageNumber:1,                       //初始化加载第一页，默认第一页              pageSize: 10,                       //每页的记录行数（*）              pageList: [5, 10],        			//可供选择的每页的行数（*）              search: false,                       //是否显示表格搜索，此搜索是客户端搜索，不会进服务端，所以，个人感觉意义不大              strictSearch: true,              showColumns: false,                  //是否显示所有的列              showRefresh: false,                  //是否显示刷新按钮              minimumCountColumns: 2,             //最少允许的列数              clickToSelect: true,                //是否启用点击选中行              height: "",                        //行高，如果没有设置height属性，表格自动根据记录条数觉得表格高度              uniqueId: "ID",                     //每一行的唯一标识，一般为主键列              showToggle:false,                    //是否显示详细视图和列表视图的切换按钮              cardView: false,                    //是否显示详细视图              detailView: false,                   //是否显示父子表              queryParams: function queryParams(params) {   //设置查询参数                var param = {                      pageNumber: params.pageNumber,                      pageSize: params.pageSize,                    grade : 2,                    flagDicDb:2,                    userId:userid,                    userName:username,                    isDeleted : isDeleted                };                  return param;                               },                           formatLoadingMessage: function () {                  return "请稍等，正在加载中...";              },              formatNoMatches: function () {  //没有匹配的结果                  return '无符合条件的记录';              },               columns : columnNames,             	responseHandler: function(data){             		return data.rows;             	}            });   	    	   	     },error:function(e){	    		parent.location.reload();    	    			}        });      }      //修改界面      function edit_privilege_user(id){      	  $("#hid_userId").val(id);    	  //第一步生成输入框    	  $("#getForm").ajaxSubmit({    	   	     type: "post",    	   	     url: "/hssp/configTableController/getPrivilegeUserByID?ID="+id,    	   	     dataType: "json",    	   	     success: function(data){			    	var html_sub = "";			    	var valueMap = data.valueMaps;  	   	    		var submitInputID="";  	   	    		var submitInputUSERID="";  	   	    		var submitInputUSERNAME="";    	   	    	for ( var key in data.field_description) {    	   	    		 var submitInput="";    	   	    		 var textValue=valueMap[key];		   	   	         if(key == "Id"){			   	   	       	  submitInput="<div class=\"form-group\" style=\"display:none\">"+							  	          	 "<label for=\"txt_statu\">"+data.field_description[key]+"</label>"+							  	          	 "<input type=\"text\" name=\"Description\" readonly= \"true\" class=\"form-control\" id=\"updateUser_"+key+"\" value=\""+textValue+"\" placeholder=\"\">"+							  	      	     "</div>";						  	 submitInputID=submitInput;  		   	   	         }else 			   	   	         if(key == "USERID"){				   	   	       	  submitInput="<div class=\"form-group\">"+								  	          	 "<label for=\"txt_statu\">"+data.field_description[key]+"</label>"+								  	          	 "<input type=\"text\" disabled=\"disabled\" name=\"Description\" class=\"form-control\" id=\"updateUser_"+key+"\" value=\""+textValue+"\" placeholder=\"\">"+								  	      	     "</div>";								  	      	 submitInputUSERID=submitInput;  			       			 }else 		   	   	         if(key == "USERNAME"){			   	   	       	  submitInput="<div class=\"form-group\">"+							  	          	 "<label for=\"txt_statu\">"+data.field_description[key]+"</label>"+							  	          	 "<input type=\"text\" name=\"Description\" class=\"form-control\" id=\"updateUser_"+key+"\" value=\""+textValue+"\" placeholder=\"\">"+							  	      	     "</div>";						  	  submitInputUSERNAME=submitInput;  		       			 }else if(key.indexOf("Value_") >= 0){		       				 submitInput="<div class=\"form-group\">"+						  	          	 "<label for=\"txt_statu\">"+data.field_description[key]+"</label>"+						  	          	 "<input type=\"text\" name=\"Description\" class=\"form-control\" id=\"updateUser_"+key+"\" value=\""+textValue+"\" placeholder=\"\">"+						  	      	     "</div>";					  	  	 html_sub=html_sub+submitInput;		       			 }   	         	   	    	}    	   	    	$('#myModal_privilege_user_html').html(submitInputID+submitInputUSERID+submitInputUSERNAME+html_sub);		  	       $("#myModal_privilege_user_submit_message").text("用户信息修改");  	    		   $('#myModal_privilege_user_submit').modal();    	   	    },error:function(e){	   	    		parent.location.reload();    	    				}    	  });      }            //新增界面      function add_privilege_user(id){      	  $("#hid_userId").val(id);    	  //第一步生成输入框    	  $("#getForm").ajaxSubmit({    	   	     type: "post",    	   	     url: "/hssp/configTableController/getPrivilegeUserByID?ID="+id,    	   	     dataType: "json",    	   	     success: function(data){			    	var html_sub = "";			    	var valueMap = data.valueMaps;    	   	    	for ( var key in data.field_description) {    	   	    		 var submitInput="";		   	   	         if(key == "Id"){			   	   	       	  submitInput="<div class=\"form-group\" style=\"display:none\">"+							  	          	 "<label for=\"txt_statu\">"+data.field_description[key]+"</label>"+							  	          	 "<input type=\"text\" name=\"Description\" class=\"form-control\" id=\"addUser_"+key+"\" value=\"\" placeholder=\"\">"+							  	      	     "</div>";						  	 html_sub=html_sub+submitInput;  		   	   	         }else if(key == "USERID"){			   	   	       	  submitInput="<div class=\"form-group\">"+							  	          	 "<label for=\"txt_statu\">"+data.field_description[key]+"</label>"+							  	          	 "<input type=\"text\" name=\"Description\" class=\"form-control\" id=\"addUser_"+key+"\" value=\"\" placeholder=\"\">"+							  	      	     "</div>";						  	 html_sub=html_sub+submitInput; 		   	   	         }else		   	   	         if(key == "USERNAME"){			   	   	       	  submitInput="<div class=\"form-group\">"+							  	          	 "<label for=\"txt_statu\">"+data.field_description[key]+"</label>"+							  	          	 "<input type=\"text\" name=\"Description\" class=\"form-control\" id=\"addUser_"+key+"\" value=\"\" placeholder=\"\">"+							  	      	     "</div>";						  	 html_sub=html_sub+submitInput; 		       			 }else if(key.indexOf("Value_") >= 0){		       				 submitInput="<div class=\"form-group\">"+						  	          	 "<label for=\"txt_statu\">"+data.field_description[key]+"</label>"+						  	          	 "<input type=\"text\" name=\"Description\" class=\"form-control\" id=\"addUser_"+key+"\" value=\"\" placeholder=\"\">"+						  	      	     "</div>";					  	  	 html_sub=html_sub+submitInput;		       			 }   	         	   	    	}    	   	    	$('#myModal_privilege_user_html').html(html_sub);		  	       $("#myModal_privilege_user_submit_message").text("新增用户信息");  	    		   $('#myModal_privilege_user_submit').modal();    	   	    },error:function(e){	   	    		parent.location.reload();    	    				}    	  });      }            function saveUser(){      	   var id =$("#hid_userId").val();	       $("#getForm").ajaxSubmit({    	   	     type: "post",    	   	     url: "/hssp/configTableController/getPrivilegeUserByID?ID="+id,    	   	     dataType: "json",    	   	     success: function(data){    	   	         var value_id ="";    	   	         var  updateDatas = {};    	   	         if(data.valueMaps.lengt == 0){    	   	        	alert("当前用户已存在!");    	   	         }	    	   	     for ( var key in data.field_description) {		    	   	     if(id=="new"){	    	   	         	value_id="addUser_";	    	   	         }else{	    	   	         	value_id="updateUser_";	    	   	         }		    	   	     value_id=value_id+key;		    	   	     updateDatas[key]=$("#"+value_id).val();	    	   	     }	    	   	     $.ajax({				 	        type:"POST",				 	        url:"/hssp/configTableController/updateUser",				 	        dataType: "json",				 	        data:updateDatas,				 	        cache: false,					        async : false,				 	        success:function(result){				 	        	if (result.status == "succeed"){				 	        		alert("修改成功!");				 	        	}				 	        	if (result.status == "addSucceed"){				 	        		alert("新增成功!");				 	        	}				 	        	if (result.status == "addExist"){				 	        		alert("当前用户已存在!");				 	        		return;				 	        	}				 	        	if (result.status == "addEmpty"){				 	        		alert("用户名或者用户ID不可为空!");				 	        		return;				 	        	}				 	        	queryUser(0);							}				 	    });    	   	     },error:function(e){ 	   	    		parent.location.reload();    	     				}	    	});      }            //删除恢复角色    function restoreUser(id,isDeleted){    	var datas = {	    	id : id,	    	isDeleted : isDeleted    	};		 $.ajax({ 	        type:"POST", 	        url:"/hssp/configTableController/deleteUser", 	        dataType: "json", 	        data:datas, 	        cache: false,	        async : false, 	        success:function(result){ 	        	if (result.status == "succeed" && isDeleted=="0"){ 	        		alert("该用户恢复成功，请在有效列表查看!"); 	        	} 	        	if (result.status == "succeed" && isDeleted=="1"){ 	        		alert("该用户删除成功，可以在回收站恢复!"); 	        	}			},error:function(e){   	    		parent.location.reload();    	    			} 	    }); 	    if(isDeleted=="0"){			queryUser(1); 	    }else{			queryUser(0); 	    }    }        /**	 * 搜索用户 	 */	function user_search() {		var isDeleted=$("#hid_isDeleted").val();		initTable(isDeleted,$("#search_userId").val(),$("#search_userName").val());	}</script></html>